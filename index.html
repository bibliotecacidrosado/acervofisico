<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Acervo Físico - Biblioteca Cid Rosado</title>
  <style>
    :root {
      --cor-primaria: #ff8c00;
      --cor-secundaria: #ffb74d;
      --cor-texto: #333;
      --cor-fundo: #f5f5f5;
      --cor-borda: #ddd;
      --cor-disponivel: #2e7d32;
      --cor-indisponivel: #c62828;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body { 
      font-family: Arial, sans-serif; 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 15px;
      background: var(--cor-fundo);
      color: var(--cor-texto);
      line-height: 1.5;
    }
    
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    h1 {
      background: var(--cor-primaria); 
      color: #fff; 
      padding: 15px; 
      border-radius: 8px;
      margin-bottom: 10px;
      font-size: 1.5rem;
    }
    
    .info-biblioteca {
      background: white;
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 15px;
    }
    
    .resumo {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .resumo-item {
      text-align: center;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 6px;
    }
    
    .resumo-numero {
      font-size: 20px;
      font-weight: bold;
      color: var(--cor-primaria);
      margin-top: 5px;
    }
    
    #busca {
      width: 100%; 
      padding: 12px; 
      margin-bottom: 15px; 
      border-radius: 5px; 
      border: 1px solid var(--cor-borda); 
      font-size: 16px;
    }
    
    .filtros {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    select {
      padding: 10px;
      border-radius: 5px;
      border: 1px solid var(--cor-borda);
      width: 100%;
    }
    
    .lista-container {
      border: 1px solid var(--cor-borda); 
      border-radius: 5px;
      background: white;
      margin-bottom: 20px;
      overflow-x: auto;
    }
    
    .cabecalho, .livro {
      display: grid; 
      grid-template-columns: 2fr 1.5fr 1fr 1.5fr 1.2fr;
      padding: 12px; 
      gap: 10px;
      min-width: 600px;
    }
    
    .cabecalho {
      background: var(--cor-secundaria); 
      font-weight: bold; 
      border-bottom: 2px solid var(--cor-primaria);
    }
    
    .livro:nth-child(odd) {background: #fff;}
    .livro:nth-child(even) {background: #f9f9f9;}
    .livro:hover {
      background: #f0f0f0;
    }
    
    .status {font-weight: bold;}
    .disponivel {color: var(--cor-disponivel);}
    .indisponivel {color: var(--cor-indisponivel);}
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
      text-align: center;
    }

    /* --- Versão Mobile --- */
    @media (max-width: 768px) {
      .resumo {
        grid-template-columns: 1fr;
      }
      
      .filtros {
        grid-template-columns: 1fr;
      }
      
      .cabecalho {
        display: none;
      }
      
      .livro {
        display: block; 
        padding: 15px;
        border-bottom: 1px solid #ddd;
        min-width: unset;
      }
      
      .livro > span {
        display: block;
        width: 100%;
        padding: 5px 0;
        margin-bottom: 5px;
      }
      
      .livro > span::before {
        font-weight: bold;
        color: #333;
        display: inline-block;
        width: 100px;
        content: attr(data-label);
      }
      
      .lista-container {
        overflow-x: visible;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Acervo Físico - Biblioteca Cid Rosado</h1>
    <div class="info-biblioteca">
      <p>Atualizado automaticamente a partir do Google Sheets</p>
    </div>
  </header>
  
  <div class="resumo" id="resumo">
    <div class="resumo-item">
      <div>Total de livros</div>
      <div class="resumo-numero" id="total-livros">0</div>
    </div>
    <div class="resumo-item">
      <div>Disponíveis</div>
      <div class="resumo-numero" id="total-disponiveis">0</div>
    </div>
  </div>
  
  <div id="mensagem"></div>
  
  <input type="text" id="busca" placeholder="Buscar por título, autor, gênero ou localização..." oninput="filtrarLivros()">

  <div class="filtros">
    <div>
      <select id="filtroStatus" onchange="filtrarLivros()">
        <option value="todos">Todos os status</option>
        <option value="Disponível">Disponível</option>
        <option value="Indisponível">Indisponível</option>
      </select>
    </div>
    <div>
      <select id="filtroGenero" onchange="filtrarLivros()">
        <option value="todos">Todos os gêneros</option>
        <!-- Opções serão preenchidas dinamicamente -->
      </select>
    </div>
  </div>

  <div class="lista-container">
    <!-- Cabeçalho da lista -->
    <div class="cabecalho">
      <span>Título</span>
      <span>Autor</span>
      <span>Gênero</span>
      <span>Localização</span>
      <span>Status</span>
    </div>
    <div id="listaLivros">
      <div class="loading" id="loading-message">
        <p>Carregando acervo...</p>
      </div>
    </div>
  </div>

  <script>
    // URL do arquivo JSON no GitHub
    const URL_JSON = 'https://raw.githubusercontent.com/bibliotecacidrosado/acervofisico/refs/heads/main/dados.json';
    
    let livrosAcervo = [];
    let dadosCompletos = [];
    let generosDisponiveis = [];

    // Função para corrigir caracteres especiais
    function corrigirCaracteres(texto) {
      if (!texto) return texto;
      
      return texto.toString()
        .replace(/S\?o/g, 'São')
        .replace(/Dispon\?vel/g, 'Disponível')
        .replace(/Indispon\?vel/g, 'Indisponível')
        .replace(/\?/g, 'ã')
        .replace(/\?/g, 'á')
        .replace(/\?/g, 'â')
        .replace(/\?/g, 'é')
        .replace(/\?/g, 'ê')
        .replace(/\?/g, 'í')
        .replace(/\?/g, 'ó')
        .replace(/\?/g, 'ô')
        .replace(/\?/g, 'ú')
        .replace(/\?/g, 'ç')
        .replace(/\?/g, 'ü');
    }

    // Função para processar os dados com correção de caracteres
    function processarDadosComCorrecao(dados) {
      if (dados && dados.livros) {
        dados.livros.forEach(livro => {
          livro.titulo = corrigirCaracteres(livro.titulo);
          livro.autor = corrigirCaracteres(livro.autor);
          livro.genero = corrigirCaracteres(livro.genero);
          livro.editora = corrigirCaracteres(livro.editora);
          livro.cidade = corrigirCaracteres(livro.cidade);
          livro.localizacao = corrigirCaracteres(livro.localizacao);
          livro.status = corrigirCaracteres(livro.status);
        });
      }
      return dados;
    }

    function mostrarMensagem(texto, tipo) {
      const mensagemDiv = document.getElementById('mensagem');
      mensagemDiv.innerHTML = `<div class="${tipo}">${texto}</div>`;
      
      if (tipo !== 'error') {
        setTimeout(() => {
          mensagemDiv.innerHTML = '';
        }, 3000);
      }
    }

    async function carregarDados() {
      try {
        mostrarMensagem('Carregando dados do acervo...', 'loading');
        
        const response = await fetch(URL_JSON);
        
        if (!response.ok) {
          throw new Error(`Erro ao carregar: ${response.status}`);
        }
        
        const dados = await response.json();
        
        // Aplicar correção de caracteres
        const dadosCorrigidos = processarDadosComCorrecao(dados);
        
        // Verificar se os dados têm a estrutura esperada
        if (!dadosCorrigidos.livros || !Array.isArray(dadosCorrigidos.livros)) {
          throw new Error('Formato inválido do arquivo JSON');
        }
        
        dadosCompletos = dadosCorrigidos.livros;
        livrosAcervo = [...dadosCompletos];
        
        // Extrair gêneros únicos para o filtro
        extrairGeneros();
        
        // Preencher a lista de livros
        atualizarLista(dadosCorrigidos);
        
        mostrarMensagem('Dados carregados com sucesso!', 'success');
        
      } catch (error) {
        console.error('Erro ao carregar dados:', error);
        mostrarMensagem('Erro ao carregar dados. Verifique a conexão.', 'error');
        document.getElementById('loading-message').innerHTML = '<p>Erro ao carregar o acervo</p>';
      }
    }

    function extrairGeneros() {
      const generosSet = new Set();
      dadosCompletos.forEach(livro => {
        if (livro.genero && livro.genero.trim() !== '') {
          generosSet.add(livro.genero);
        }
      });
      
      generosDisponiveis = Array.from(generosSet).sort();
      
      const filtroGenero = document.getElementById('filtroGenero');
      // Manter a primeira opção ("Todos os gêneros")
      while (filtroGenero.options.length > 1) {
        filtroGenero.remove(1);
      }
      
      // Adicionar os gêneros extraídos
      generosDisponiveis.forEach(genero => {
        const option = document.createElement('option');
        option.value = genero;
        option.textContent = genero;
        filtroGenero.appendChild(option);
      });
    }

    function atualizarResumo(dados) {
      const totalLivros = dados.livros?.length || 0;
      const totalDisponiveis = dados.livros?.filter(l => l.status === 'Disponível').length || 0;
      
      document.getElementById('total-livros').textContent = totalLivros;
      document.getElementById('total-disponiveis').textContent = totalDisponiveis;
    }

    <script>
function atualizarLista(dados){
  // Aplicar correção de caracteres
  dados = processarDadosComCorrecao(dados);
  
  const lista = document.getElementById('listaLivros');
  const resumo = document.getElementById('resumo');
  
  // Atualizar resumo
  atualizarResumo(dados);
  
  // Limpar lista
  lista.innerHTML = '';
  
  // Verificar se há livros para mostrar
  if (!dados.livros || dados.livros.length === 0) {
    lista.innerHTML = '<div class="loading">Nenhum livro encontrado</div>';
    return;
  }
  
  // Adicionar livros à lista
  dados.livros.forEach(l => {
    const div = document.createElement('div');
    div.className = 'livro';
    
    // Preparar para mobile - adicionar atributos data-label
    if (window.innerWidth <= 768) {
      div.innerHTML = `
        <span data-label="Título: ">${l.titulo || 'Não informado'}</span>
        <span data-label="Autor: ">${l.autor || 'Não informado'}</span>
        <span data-label="Gênero: ">${l.genero || 'Não informado'}</span>
        <span data-label="Localização: ">${l.localizacao || 'Não informado'}</span>
        <span data-label="Status: " class="status ${l.status === 'Disponível' ? 'disponivel' : 'indisponivel'}">
          ${l.disponiveis > 0 ? `${l.disponiveis} exemplar(es) ${l.status}` : l.status}
        </span>`;
    } else {
      div.innerHTML = `
        <span>${l.titulo || 'Não informado'}</span>
        <span>${l.autor || 'Não informado'}</span>
        <span>${l.genero || 'Não informado'}</span>
        <span>${l.localizacao || 'Não informado'}</span>
        <span class="status ${l.status === 'Disponível' ? 'disponivel' : 'indisponivel'}">
          ${l.disponiveis > 0 ? `${l.disponiveis} exemplar(es) ${l.status}` : l.status}
        </span>`;
    }
    
    lista.appendChild(div);
  });
}

    function filtrarLivros(){
      const termo = document.getElementById('busca').value.toLowerCase();
      const statusFiltro = document.getElementById('filtroStatus').value;
      const generoFiltro = document.getElementById('filtroGenero').value;
      
      const listaFiltrada = dadosCompletos.filter(l => {
        // Filtro por termo de busca
        const correspondeTermo = 
          (l.titulo && l.titulo.toLowerCase().includes(termo)) ||
          (l.autor && l.autor.toLowerCase().includes(termo)) ||
          (l.genero && l.genero.toLowerCase().includes(termo)) ||
          (l.localizacao && l.localizacao.toLowerCase().includes(termo));
        
        // Filtro por status
        const correspondeStatus = statusFiltro === 'todos' || l.status === statusFiltro;
        
        // Filtro por gênero
        const correspondeGenero = generoFiltro === 'todos' || l.genero === generoFiltro;
        
        return correspondeTermo && correspondeStatus && correspondeGenero;
      });

      atualizarLista({
        livros: listaFiltrada, 
        totalLivros: listaFiltrada.length,
        totalDisponiveis: listaFiltrada.filter(l => l.status === 'Disponível').length
      });
    }

    // Carregar dados automaticamente ao abrir a página
    document.addEventListener('DOMContentLoaded', function() {
      carregarDados();
      document.getElementById('busca').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          filtrarLivros();
        }
      });
    });
  </script>
</body>
</html>
